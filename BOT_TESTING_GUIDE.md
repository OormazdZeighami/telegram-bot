# 🧪 راهنمای تست و عیب‌یابی ربات

## 🎯 مشکل فعلی
ربات در حال اجرا است اما ممکن است به دلیل وجود ربات‌های دیگر (مثل Perplexity) در گروه، دستورات به ربات ما نرسد.

## ✅ راه‌حل‌های پیاده‌سازی شده

### 1. **اضافه کردن Debugging**
- Log تمام پیام‌های دریافتی
- نمایش اطلاعات کاربر و چت
- دستورات تست جدید

### 2. **پاک کردن Webhook**
- پاک کردن خودکار webhook های قدیمی
- اطمینان از polling mode

### 3. **دستورات تست جدید**
- `/test` - تست کامل ربات
- `/ping` - تست ساده
- Logging کامل

## 🧪 نحوه تست

### مرحله 1: تست در پیوی (Private Chat)
1. به ربات در پیوی پیام دهید: `/start`
2. دستور `/test` را ارسال کنید
3. دستور `/ping` را ارسال کنید

### مرحله 2: تست در گروه
1. در گروه دستور `/test` را ارسال کنید
2. دستور `/ping` را ارسال کنید
3. دستور `/botstatus` را ارسال کنید

### مرحله 3: بررسی Console
در ترمینال باید این پیام‌ها را ببینید:
```
📨 Message received: { from: 'UserName', userId: 123456, chatId: -123456, text: '/test', type: 'group' }
🎯 /test command received from: 123456 in chat: -123456
```

## 🔍 عیب‌یابی

### اگر پیام‌ها در console نمایش داده نمی‌شوند:
**مشکل**: ربات پیام‌ها را دریافت نمی‌کند
**راه‌حل**:
1. بررسی کنید که ربات در گروه باشد
2. ربات را ادمین گروه کنید
3. `/botstatus` را اجرا کنید

### اگر پیام‌ها نمایش داده می‌شوند اما پاسخ نمی‌دهد:
**مشکل**: مشکل در ارسال پیام
**راه‌حل**:
1. بررسی کنید که ربات دسترسی ارسال پیام داشته باشد
2. `/restartpolling` را اجرا کنید

### اگر ربات در پیوی کار می‌کند اما در گروه نه:
**مشکل**: مشکل permissions در گروه
**راه‌حل**:
1. ربات را ادمین گروه کنید
2. دسترسی‌های لازم را بدهید

## 📊 دستورات تست موجود

### 🧪 **دستورات تست:**
- `/test` - تست کامل با اطلاعات کاربر
- `/ping` - تست ساده
- `/botstatus` - وضعیت ربات

### 🔧 **دستورات مدیریت:**
- `/restartpolling` - راه‌اندازی مجدد polling
- `/stopbot` - متوقف کردن ربات
- `/setadmin [id]` - تنظیم ادمین

### ⚠️ **دستورات اخطار:**
- `/warn` - اخطار دادن
- `/testwarn` - اخطار تست
- `/warnhelp` - راهنمای اخطار

## 🎯 مراحل تست پیشنهادی

### 1. تست اولیه
```
/ping
```
**انتظار**: پاسخ "🏓 pong - ربات فعال است!"

### 2. تست کامل
```
/test
```
**انتظار**: اطلاعات کامل کاربر و چت

### 3. تست وضعیت
```
/botstatus
```
**انتظار**: اطلاعات ربات و uptime

### 4. تست اخطار (اگر ادمین هستید)
```
/testwarn
```
**انتظار**: اخطار تست

## 📝 بررسی Console Output

### پیام‌های عادی:
```
✅ ربات کوییز با موفقیت روشن شد!
Bot connected as @TestQuizzForGroupBot (id: 7132943895)
✅ Bot polling started successfully
```

### پیام‌های پیام دریافتی:
```
📨 Message received: { from: 'UserName', userId: 123456, chatId: -123456, text: '/test', type: 'group' }
🎯 /test command received from: 123456 in chat: -123456
```

### پیام‌های خطا:
```
❌ خطای Polling: ETELEGRAM: 409 Conflict
⚠️ Conflict detected with another bot instance
```

## 🚨 مشکلات رایج

### مشکل 1: "ربات کار نمی‌کند"
**راه‌حل**:
1. `/botstatus` را اجرا کنید
2. اگر conflict است، ربات را restart کنید
3. از `start_bot.bat` استفاده کنید

### مشکل 2: "پیام‌ها دریافت نمی‌شوند"
**راه‌حل**:
1. ربات را ادمین گروه کنید
2. `/restartpolling` را اجرا کنید
3. Console را برای پیام‌های debug بررسی کنید

### مشکل 3: "پیام‌ها دریافت می‌شوند اما پاسخ نمی‌دهد"
**راه‌حل**:
1. بررسی permissions ربات
2. `/test` را در پیوی امتحان کنید
3. `/restartpolling` را اجرا کنید

## 🔄 Workflow تست

### روزانه:
1. `/ping` را اجرا کنید
2. `/botstatus` را بررسی کنید
3. اگر مشکل است، `/restartpolling` اجرا کنید

### در صورت مشکل:
1. Console را بررسی کنید
2. `/test` را در پیوی امتحان کنید
3. ربات را restart کنید
4. از `start_bot.bat` استفاده کنید

## 📈 نتایج مورد انتظار

### Console Output سالم:
```
✅ ربات کوییز با موفقیت روشن شد!
Bot connected as @TestQuizzForGroupBot (id: 7132943895)
✅ Bot polling started successfully
📨 Message received: { from: 'UserName', userId: 123456, chatId: -123456, text: '/test', type: 'group' }
🎯 /test command received from: 123456 in chat: -123456
```

### پاسخ‌های صحیح:
- `/ping` → "🏓 pong - ربات فعال است!"
- `/test` → اطلاعات کاربر و چت
- `/botstatus` → وضعیت کامل ربات

## 💡 نکات مهم

1. **همیشه console را بررسی کنید** - پیام‌های debug مهم هستند
2. **ابتدا در پیوی تست کنید** - مشکلات permissions را حذف کنید
3. **ربات را ادمین کنید** - دسترسی‌های لازم را بدهید
4. **از دستورات مدیریتی استفاده کنید** - `/restartpolling`, `/botstatus`
5. **در صورت مشکل، restart کنید** - از `start_bot.bat` استفاده کنید
